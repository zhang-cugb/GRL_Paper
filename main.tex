\documentclass[a4paper]{article}

%% Language and font encodings
\usepackage[english]{babel}
\usepackage[utf8x]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[parfill]{parskip}

%% Sets page size and margins
\usepackage[a4paper,top=1.5cm,bottom=1.5cm,left=2cm,right=2cm,marginparwidth=1.75cm]{geometry}

%% Useful packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\newcommand{\matr}[1]{\mathbf{#1}}
\usepackage{subcaption}
\usepackage{subfiles}
\usepackage{natbib}
\bibliographystyle{abbrvnat}


\title{Partitioning Thresholds in Hybrid Implicit and Explicit Representations of Naturally Fractured Reservoirs}
\author{Daniel Wong Lorng Yon \and Florian Doster \and Sebastian Geiger \and Arjan Kamp}

\begin{document}
\maketitle

\textbf{Key Points}
\begin{itemize}
	\item Small fractures up to a threshold size can be lumped with the rock matrix and upscaled into an equivalent porous medium without affecting the resulting model's accuracy.
	\item The threshold size can be determined from the relationship between upscaled permeabilities and partitioning sizes, the latter which determines whether or not a fracture is considered small.
	\item This relationship can generally be established via numerical flow based upscaling, but for penny shaped fractures, the more efficient Effective Medium Theory can also be used.
\end{itemize}

\begin{abstract}
Flow modeling in naturally fractured reservoirs is a challenging task due to the multiscale nature of fracture networks. The process can be simplified by upscaling small fractures with the rock matrix into an equivalent porous medium, and representing large fractures explicitly. The resulting model is a Single Porosity (SP) hybrid model. Different models can be created based on the choice of the partitioning size, which determines how the fractures are divided. For small partitioning sizes, more fractures will be represented, which leads to higher computational costs. On the other hand, excessively large partitioning sizes may result in an undesirable loss of details. In our studies, for each dataset, we observe that up to a threshold partitioning size, hybrid models closely match original models in terms of simulation output. However, beyond the threshold, hybrid model results show marked deviations away from reference solutions. The threshold partitioning size can be identified from the relationship between upscaled permeabilities and partitioning sizes, and corresponds to the point where the effective permeability of small fractures begin to increase rapidly. The relationship can be obtained numerically via flow based upscaling, or analytically using the Effective Medium Theory. The former method is robust but slow, while the latter is restricted to elliptical fractures but is significantly faster.
\end{abstract}

\section{Introduction}
Naturally fractured reservoirs (NFR) are commonplace in nature and of great interest in areas including but not limited to hydrocarbon extraction, geothermal resource exploitation, and containment of nuclear waste disposal \citep{Berkowitz2002}. More recently, there has also been 
interest in NFRs as a potential site for carbon sequestration \citep{March2018}. In all these applications, the central process at play is fluid flow in fractured porous media, and accurately modelling this process is crucial for engineering success.

However, the highly heterogeneous nature of NFRs makes flow modelling difficult. Instead of representing all fractures in a simulation model, a popular approach, known as the continuum method, is to represent the fracture network as equivalent porous media \citep{Ezulike2013, Lemonnier2010a, Lemonnier2010, Warren1963, Yan2016}. The conversion from discrete fractures to a continuum representation involves an averaging process known as upscaling, which can be performed numerically or analytically \citep{Durlofsky1991,Oda1985,Renard1997,Saevik2013}. 

In this paper, we make extensive use of an analytical upscaling tool known as the Effective Medium Theory (EMT) which was recently adapted for fractured porous media, and was shown to outperform traditional techniques like Oda's method. This is because EMT directly addresses the effects of fracture sizes on upscaled permeabilities while Oda's method assumes fractures have infinite length, which automatically implies well-connectedness \citep{Oda1985, Saevik2013, Saevik2014}.

For multiscale NFRs, unfortunately, upscaled equivalent permeability fields have been shown to be dependent on the choice of homogenization scale; this will eventually lead to varying flow modelling outcomes \citep{Elfeel2013}. In particular, NFRs tend to contain fractures with various sizes that oftentimes follow a power law distribution \citep{Bonnet2001}. This implies that no Representative Elementary Volume (REV) can be defined, which invalidates the upscaling step necessary in continuum modelling \citep{Berkowitz2002}.

Nevertheless, as fully resolving all fractures in a simulation model is prohibitively expensive, model simplification is still highly desirable. One way forward is to use a divide-and-conquer approach known as hybrid modelling \citep{Berkowitz2002, Bourbiaux2010}. In this method, the fracture network has to be partitioned into two sets: one set with fracture sizes less than the partitioning size, and another with larger fractures. Using either numerical or analytical upscaling, small fractures and the rock matrix are replaced with equivalent porous media. Meanwhile, the large fractures are explicitly represented. Constructing a hybrid model using a small partitioning size preserves as much details as possible, at the expense of computational efficiency. On the other hand, large partitioning sizes yield significant model reductions, but at the cost of model accuracy.

In this paper, we compare performances of hybrid models created using various partitioning sizes against full model solutions. The hybrid models are constructed by upscaling the matrix and small fractures into a single continuum, and as such are called Single Porosity (SP) hybrid models. The results ascertain that hybrid models can indeed be used to simplify complex fractured reservoir simulations, but is restricted to partitioning sizes below observed thresholds. From the relationship between effective permeability and partitioning size, we also observe that the thresholds correspond with partitioning sizes where the effective permeability of small fractures begin to increase rapidly. This relationship can be produced using numerical flow based upscaling, but for penny shaped fractures, the more efficient EMT can also be used.

\section{Methods}

\subsection{Data}
The Discrete Fracture Networks (DFN) used in this study are either (1) generated in 3D using the procedures laid out in \citet{Priest1993}, or (2) based on realistic fracture networks (Figure \ref{fig:DD}) \citep{Bisdom2017}.

For each 3D DFN, three orthogonal sets of fractures are generated stochastically; the base parameters used are the fracture density ($P_{32}=0.15m^2/m^3$ per fracture set), the power law exponent of fracture sizes ($n_s=1.5$), and the fracture size range ($s_{min}=5m$ and $s_{max}=20m$ in radii). Fractures are circular in shape with an aperture-size ratio of $1.75\times 10^{-5}$. Aperture is used to calculate fracture intrinsic permeabilities using the cubic law \citep{Witherspoon1980}. Rock permeability used is $K_m=10mD$. Four different cases are considered: (A) Base parameters, (B) $2\times P_{32}$, (C) $2\times n_s$ and (D) $2\times s_{min}$. Examples of these DFNs are shown in Figures \ref{fig:DD_A}, \ref{fig:DD_B}, \ref{fig:DD_C} and \ref{fig:DD_D}.

The 2D DFNs are created from a publicly available dataset containing trace maps of fractures observed on outcrops of the Jandaira Carbonate Formation in Brazil. The trace maps used in this study are the Apodi 2 and 4 maps, named after the municipality where the outcrop is located. Both fracture networks are multiscale in nature and exhibit fracture sizes (lengths) ranging across two orders of magnitude \citep{Bisdom2017}. As no reliable aperture information were obtained for these fracture networks, we assume an aperture-size ratio of $3.5\times 10^{-5}$ and again use the cubic law. Rock permeability used is $K_m=1mD$. The fracture networks are shown in Figures \ref{fig:DD_A2} and \ref{fig:DD_A4}.


\subsection{Simulation Setup}
The simulations in this paper are performed using the Embedded Discrete Fracture Model (EDFM), which is available through the MATLAB Reservoir Simulation Toolbox (MRST) \citep{Lee2001, Lie2015, Moinfar2013}. EDFM uses non-neighbouring connections to facilitate fracture-matrix and fracture-fracture flow. This decouples the matrix grid from the fracture network geometry and eases grid construction. EDFM also allows painless modifications to create hybrid models by removing fractures and updating matrix permeabilities.

To create a hybrid model, we first need to upscale all fractures smaller than a selected partitioning size, $s_p$ - we call this Fracture Subset Upscaling (FSU). FSU using EDFM is done by solving the Laplace equation for a square domain containing only fractures with sizes in $[s_{min},s_p]$, subject to a pressure differential on two opposing boundaries, and no-flow boundary on the remaining ones. This yields a flow field that can be used to calculate an effective permeability, $K_{e}$, using Darcy's law. The calculated $K_{e}$ is a function of $s_p$. For the 3D DFNs, FSU was also performed using EMT since the fractures are circular in shape. The results are summarized in FSU curves (Figure \ref{fig:FSU}) that plot $K_{e}/K_m$ against $s_p$, where $K_m$ is rock matrix permeability.

Given $s_p$, once small fractures are upscaled to obtain $K_e$, a SP hybrid model containing only fractures ranging from $[s_p,s_{max}]$ can be constructed. The background permeability used in the hybrid model is $K_e$ instead of $K_m$. Using the FSU curves in Figure \ref{fig:FSU}, for each dataset, we created a set of hybrid models corresponding to different $s_p$. 

The hybrid models, along with the original full DFN model, are subjected to similar production conditions in order to compare their performances. The 3D DFN models are tested using fixed pressure boundary conditions while the 2D outcrop-based models are tested using a well test drawdown using a fixed flowrate sink (Figure \ref{fig:DD}). In all cases, initial pressure is $100 bars$ and typical oil properties are used ($\rho_o=700 kg/m^3$, $\mu_o=5 cP$, $c_o=10^{-5} {bars}^{-1}$). The results of these drawdown tests are shown in Figure \ref{fig:DD}.

\section{Results}
\subsection{Effective Permeability and Partitioning Size}
Numerical FSU results are shown in Figure \ref{fig:FSU} for the four 3D cases and outcrop-based DFNs. For the 3D cases, since a stochastic method is used to generate the DFNs, in order to capture variations due to the power law size distribution, 10 realizations were created for each parameter set. 

The FSU curves show that $K_e/K_m$ increases monotonically with with $s_p$. This is because as $s_p$ increases, the size range of fractures that are upscaled increases, resulting in a denser fracture subset. This naturally enhances the overall conductivity of the subset.

It can also be observed that the FSU curves show a percolation behaviour, where $K_e$ suddenly increases rapidly past some threshold $s_p$. This implies that with low $s_p$ values, fracture subsets are not well connected, but as $s_p$ increases, not only does the number of fractures in the subset increase, but the connectivity of the fracture subset increases as well. This will have implications on the suitability of representing a fracture subset as a Single Porosity medium.

For the 3D cases, when the fracture density is doubled (Case B), for the same $s_p$, the resulting fracture subset contains more fractures, which would result in a higher overall conductivity. The fracture subset would also be more likely to become connected. This is reflected in Figure \ref{fig:FSU_B} which shows higher overall $K_e$ and an earlier percolation.

In Case C, where the power law size exponent is doubled, this results in a higher proportion of small sized fractures, which causes the fracture subset to percolate earlier, as seen in Figure \ref{fig:FSU_C}. In Case D, the range of fracture sizes is smaller. Subsequently, $K_e$ begins to increase rapidly from the smallest $s_p$, as seen in \ref{fig:FSU_C}. 

\subfile{FSU/FSU_main.tex}

\subsection{Single Phase Flow in Hybrid Models}
For the 3D DFNs, a fixed pressure boundary of $50bars$ is applied on the models to simulate a drawdown. Due to the high fracture-to-rock permeability ratio, the pressure drop preferentially diffuses through the fracture network, before diffusing into the rock matrix. This results in an intermediate plateau observed in the outlet flowrate evolution when the rock matrix is recharging the fluid pressure in the fractures.

For Apodi 2, a well is inserted in the rock matrix and drawn down at a fixed rate of $0.1m^3/day$. The pressure derivative response at the well initially shows an infinite acting regime when the perturbation at the well only diffuses through the matrix. Once the effect of the well drawdown reaches the nearest fracture, fluid depletion from the fracture network dominates, and a dip on the pressure derivative can be observed \citep{Bourdet1989, Cinco-Ley1976, Egya2018}.

For Apodi 4, a well is positioned to intersect the largest fracture in the domain and drawn down at a rate of $1m^3/day$. In this setup, the pressure drop at the well diffuses first through the fracture network as though the rock matrix is impermeable. Once fluid pressure in the fractures have dropped significantly, the fluid contained in the rock begins to recharge the fracture network. This results in a dip on the pressure derivative as well \citep{Gringarten1987}.

In all six studies, it is observed that hybrid models created with small $s_p$ produce drawdown results that are very similar to the corresponding full model responses. However, above some threshold partitioning size, $s_p^*$, the hybrid models begin to produce results with large deviations. The only exception is Case D, which shows significant differences even at a very small $s_p$; this is due to the small fracture size range used, which results in a large number of small fractures after partitioning. 

From a practical perspective, a threshold partitioning size, $s_p^*$, implies that while we want to reduce computational load by upscaling small fractures, there is a limit to how large $s_p$ can be. This is because as $s_p>s_p^*$, we begin to simplify our simulation model at the expense of output accuracy.

\subfile{DD_main/DD_figs.tex}

\subsection{Accuracy of Effective Medium Theory}
The FSU curves generated for the 3D DFNs using EMT are also shown in Figure \ref{fig:FSU}. In general, there is a good match between the results obtained from both numerical and analytical approaches. However, EMT is significantly more efficient and reduces the FSU processing time from hours to seconds.

Two different formulations of EMT are used in this study for comparison - the asymmetric and symmetric self-consistent versions. In existing benchmarking studies using constant sized fracture networks, the former has been shown to predict percolation thresholds better than the latter, but tends to over-predict effective permeability \citep{Saevik2013, Saevik2014}. In our study, we observe that the symmetric self-consistent EMT performs best in terms of overall $K_e$ calculations. However, similar to \citet{Saevik2013}, we note that the asymmetric variant of EMT is more predictive in terms of threshold partitioning size, $s_p^*$.

\section{Discussion}
\subsection{Effect of Partitioning Size on Response Accuracy}
Discuss how hybrid models corresponding to low partitioning size match full model results very well, but in all cases, above a certain threshold, $s_p^*$, output starts to deviate.

\subsection{\textit{A priori} Identification of Partitioning Threshold}
Discuss identification of $s_p^*$ by plotting $K_{eff}/K_m$ against $s_p$ and where $s_p^*$ is located on the FSU curves.

\section{Conclusion}
We performed numerical studies on full and hybrid models of fracture systems (created with varying partitioning sizes) by subjecting them to similar production conditions. Analysis of the results obtained showed that:

\begin{itemize}
    \item There exists a threshold partitioning size, $s_p^*$ beyond which SP hybrid modelling is observed to produce significant errors compared to the full model reference solution. This is evident in both generated 3D DFNs and realistic fracture networks traced from outcrops.
    
    \item FSU curves exhibit a percolation behaviour and takes on an S-shape. For our studies, $s_p^*$ is consistently located right before fracture subset effective permeability starts to increase rapidly. This is consistent with the requirement that no separation of scale should occur in order to use a SP model.
    
    \item Numerical FSU is a slow process which takes hours to complete. For elliptical fractures, FSU can be performed analytically using EMT, which reduces processing time to seconds. FSU results by EMT were shown to match numerical FSU results very well. $s_p^*$ can also be identified from the EMT FSU curves. 
    
\end{itemize}


\bibliography{/Users/danie/Documents/phd-daniel/Bibtex/library}

\end{document}